var innopia=innopia||{};innopia.dial=innopia.dial||{};dlog=function(m){};innopia.dial.search=function(e){const t=1900;const r="239.255.255.250";const a=10;const l="urn:dial-multiscreen-org:service:dial:1";const i=/HTTP\/\d{1}\.\d{1} \d+ .*/;const s="kplayer";const n="M-SEARCH * HTTP/1.1\r\n"+"HOST: "+r+":"+t+"\r\n"+'MAN: "ssdp:discover"\r\n'+"MX: "+a+"\r\n"+"ST: "+l+"\r\n"+"\r\n";const o=["wlan","rndis"];var u=false;for(var p=0;o.length>p;p++){if(o[p]==e.type){u=true}}if(u==false){e.fail({error:"invalid_parameter",error_description:"type:"+e.type+" ['wlan'|'rndis']"});return}if(!(typeof e.timeout==="number")||e.timeout<=0){e.fail({error:"invalid_parameter",error_description:"timeout:"+e.timeout});return}function d(e){this.socket=null;this.response=false;this.search=e;this.getIp=false}var c=null;d.prototype={rndis_check:function(){c=this;var a=window.navigator.dongleManager;a.ondonglestatuschange=function(e){if(e.isConnected){if(c.getIp==false){new d(c.search).start(n,r,t,e.usbIpAddress)}}};if(typeof this.search.timeout==="number"){i(l,this.search.timeout,this)}function l(t){if(c.getIp==false&&t.response==false){t.response=true;e.fail({error:"no_getip",error_description:"type:"+t.search.type})}}function i(){var e=arguments[0];var t=arguments[1];if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return i(function(){e.apply(null,r)},t)}else{return window.setTimeout(e,t)}}},start:function(t,a,l,s){this.getIp=true;if(s!=null){this.socket=new UDPSocket({localAddress:s,loopback:true})}else{this.socket=new UDPSocket({loopback:true})}this.socket.joinMulticastGroup(r);this.socket.onmessage=n.bind(this);this.socket.opened.then(function(){var e=this.socket.send(t,a,l)}.bind(this));if(typeof this.search.timeout==="number"){p(u,this.search.timeout,this)}function n(e){var t=String.fromCharCode.apply(null,new Uint8Array(e.data));dlog(t);var r=t.toString().split("\r\n");var a=r.shift();var l=i.test(a)?"RESPONSE":a.split("")[0].toUpperCase();var s={};r.forEach(function(e){if(e.length){var t=e.match(/^([^:]+):\s*(.*)$/);if(t){s[t[1].toLowerCase()]=t[2]}}});if(s.location){this.response=true;o(this.search.success,s.location,e.remoteAddress)}}function o(e,t,r){var a=new XMLHttpRequest({mozSystem:true});a.open("GET",t,true);a.overrideMimeType("text/xml");a.addEventListener("load",function(){if(a.status==200){var t=a.responseXML.querySelectorAll("device");var l=t[0].querySelector("modelName").textContent;var i=t[0].querySelector("friendlyName").textContent;var s=t[0].querySelector("UDN").textContent;var n=false;if(s=="uuid:C5D432D9-6036-4C0D-ABEF-E1B8ED4FE057"){n=true}var o="HDMI";if(l=="IMT-M532"){o="CVBS"}dlog(l);e({name:i,output:o,isJioDongle:n,ip:r,url:a.getResponseHeader("Application-URL")+"kplayer"})}}.bind(this),false);a.send(null)}function u(t){if(t.socket!=null){if(t.socket.readyState!="close"){t.socket.close}}if(t.response==false){e.fail({error:"no_response",error_description:"type:"+t.search.type})}}function p(){var e=arguments[0];var t=arguments[1];if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return p(function(){e.apply(null,r)},t)}else{return window.setTimeout(e,t)}}}};if(e.type=="wlan"){new d(e).start(n,r,t,null)}else if(e.type=="rndis"){var y=window.navigator.dongleManager;if(typeof y==="undefined"){new d(e).start(n,r,t,"192.168.0.1")}else{var f=y.dongleStatus;if(f){var h=y.usbIpAddress;if(h!=null){new d(e).start(n,r,t,h)}else{new d(e).rndis_check()}}else{new d(e).rndis_check()}}}};innopia.dial.player=innopia.dial.player||{};innopia.dial.player.currentplayer=null;innopia.dial.player.makePlayItem_audio=function(){if(arguments.length<1){return null}var e={url:null,title:null,thumbnailUrl:null,format:"audio"};var t=arguments[0];if(s(t)==true){var r=t.toLowerCase();if(r.match("http://")||r.match("https://")){e.url=t}else{return null}}else{return null}if(arguments.length>=2){var a=arguments[1];if(s(a)==true){e.title=a}}if(arguments.length>=3){var l=arguments[2];if(s(l)==true){e.thumbnailUrl=l}}if(arguments.length>=4){var i=arguments[3];if(s(i)==true){e.wvurl=i}}function s(e){if(typeof e==="string"&&e!=""){return true}return false}return e};innopia.dial.player.makePlayItem_video=function(){if(arguments.length<1){return null}var e={url:null,title:null,thumbnailUrl:null,subtitle:null,wvurl:null,format:"video"};var t=arguments[0];if(n(t)==true){var r=t.toLowerCase();if(r.match("http://")||r.match("https://")){e.url=t}else{return null}}else{return null}if(arguments.length>=2){var a=arguments[1];if(n(a)==true){e.title=a}}if(arguments.length>=3){var l=arguments[2];if(n(l)==true){e.thumbnailUrl=l}}if(arguments.length>=4){var i=arguments[3];if(n(i)==true){e.subtitle=i}}if(arguments.length>=5){var s=arguments[4];if(n(s)==true){e.wvurl=s}}function n(e){if(typeof e==="string"&&e!=""){return true}return false}return e};innopia.dial.player.makePlayList=function(){if(arguments.length<=0){return null}var e=new Array;for(var t=0;t<arguments.length;t++){var r={url:null,title:null,thumbnailUrl:null,subtitle:null,wvurl:null,type:null};var a=arguments[t].url;if(u(a)==true){var l=a.toLowerCase();if(l.match("http://")||l.match("https://")){r.url=a}else{continue}}else{continue}var i=arguments[t].title;if(u(i)==true){r.title=i}var s=arguments[t].thumbnailUrl;if(u(s)==true){r.thumbnailUrl=s}var n=arguments[t].wvurl;if(u(n)==true){r.wvurl=n}r.format=arguments[t].format;if(r.format=="video"){var o=arguments[t].subtitle;if(u(o)==true){r.subtitle=o}}e[e.length]=r}function u(e){if(typeof e==="string"&&e!=""){return true}return false}return e};innopia.dial.player.connect=function(e){function t(e){this.dialplayer=e;this.playersocket=null;this.playerstatus="stopped";this.launchstatus="stopped";this.connectresult=false;this.remoteplayerip=null;this.tmp_msg=null}t.prototype={connectDialPlayer:function(){e(this);function e(e){var l=new XMLHttpRequest({mozSystem:true});l.open("GET",e.dialplayer.server.url,true);l.overrideMimeType("text/xml");l.addEventListener("load",function(){if(l.status==200){var i=l.responseXML.getElementsByTagName("state")[0].childNodes[0].nodeValue;e.launchstatus=i;if(i==null||i.match("stopped")){t(e)}else if(i.match("running")){if(l.responseXML.getElementsByTagName("IP").length==0||l.responseXML.getElementsByTagName("IP")[0].childNodes.length==0||l.responseXML.getElementsByTagName("IP")[0].childNodes[0].nodeValue==""||l.responseXML.getElementsByTagName("IP")[0].childNodes[0].nodeValue==null){if(e.connectresult==false){e.dialplayer.fail(e.dialplayer.server,{error:"connection_error",error_description:"remote player ip is null"});e.connectresult=true}return}else{e.remoteplayerip=l.responseXML.getElementsByTagName("IP")[0].childNodes[0].nodeValue}if(e.playersocket==null){r(e)}}else if(i.match("Created")){a(_requestApplicationStatus,2e3,e)}}else{if(e.connectresult==false){e.dialplayer.fail(e.dialplayer.server,{error:"application_failed",error_description:"status_failed"});e.connectresult=true}}}.bind(this),false);l.send(null)}function t(t){var r=new XMLHttpRequest({mozSystem:true});r.open("POST",t.dialplayer.server.url,true);r.setRequestHeader("Content-Type","text/plain; charset=UTF-8");r.addEventListener("load",function(){if(r.status==200||r.status==201){a(e,1e3,t)}else{if(t.connectresult==false){t.dialplayer.fail(t.dialplayer.server,{error:"application_launch_failed",error_description:"launch_failed"});t.connectresult=true}}},false);r.send(null)}function r(e){e.playersocket=navigator.mozTCPSocket.open(e.remoteplayerip,2e4);e.playersocket.ondata=e._responseData.bind(e);e.playersocket.onerror=function(t){if(e.connectresult==false){e.dialplayer.fail(e.dialplayer.server,{error:"connection_error",error_description:"socket_error"});e.connectresult=true}else{if(e.playerstatus!="DISCONNECTED"){e.playerstatus="DISCONNECTED";e.dialplayer.changestatus(e.playerstatus);innopia.dial.player.currentplayer=null}}};e.playersocket.onclose=function(){if(e.connectresult==false){e.dialplayer.fail(e.dialplayer.server,{error:"connection_error",error_description:"socket_close"});e.connectresult=true}else{if(e.playerstatus!="DISCONNECTED"){e.playerstatus="DISCONNECTED";e.dialplayer.changestatus(e.playerstatus);innopia.dial.player.currentplayer=null}}}}function a(){var e=arguments[0];var t=arguments[1];if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return a(function(){e.apply(null,r)},t)}else{return window.setTimeout(e,t)}}},_responseData:function(e){if(typeof e.data==="string"){var t=e.data;dlog(t);var r="<status";var a="</status>";if(this.tmp_msg!=null){t=this.tmp_msg+t}if(t.substring(0,r.length)!=r){this.tmp_msg=t;return}if(t.substring(t.length-a.length,t.length)!=a){this.tmp_msg=t;return}var l=t.toString().split(a);for(d=0;d<l.length;d++){if(l[d]){var i=l[d]+a;var s=new DOMParser;var n=s.parseFromString(i,"text/xml");var o=n.getElementsByTagName("status");if(o[0].getAttribute("type").match("onPlayerStatusChange")){if(this.playerstatus.match("stopped")&&o[0].childNodes[0].nodeValue.match("CONNECTED")){this.playerstatus=o[0].childNodes[0].nodeValue;this._connectedPlayer()}else{this.playerstatus=o[0].childNodes[0].nodeValue}this.dialplayer.changestatus(this.playerstatus)}else if(o[0].getAttribute("type").match("currentVolumeResponse")){if(o[0].childNodes.length>0){this.dialplayer.response({type:"VOLUME",data:o[0].childNodes[0].nodeValue})}}else if(o[0].getAttribute("type").match("currentPositionResponse")){if(o[0].childNodes.length>0){this.dialplayer.response({type:"POSITION",data:o[0].childNodes[0].nodeValue})}}else if(o[0].getAttribute("type").match("stoppedPositionResponse")){if(o[0].childNodes.length>0){this.dialplayer.response({type:"STOPPEDPOSITION",data:o[0].childNodes[0].nodeValue})}}else if(o[0].getAttribute("type").match("playerStatusResponse")){if(o[0].childNodes.length>0){this.dialplayer.response({type:"PLAYERSTATUS",data:o[0].childNodes[0].nodeValue})}}else if(o[0].getAttribute("type").match("muteResponse")){if(o[0].childNodes.length>0){this.dialplayer.response({type:"MUTE",data:o[0].childNodes[0].nodeValue})}}else if(o[0].getAttribute("type").match("loopResponse")){if(o[0].childNodes.length>0){this.dialplayer.response({type:"LOOP",data:o[0].childNodes[0].nodeValue})}}else if(o[0].getAttribute("type").match("playListResponse")){var u=o[0].getElementsByTagName("playItem");var p=new Array;if(u.length>0){for(var d=0;u.length>d;d++){p[d]={id:0,url:null,state:0,title:null,thumbnailurl:null};if(u[d].getElementsByTagName("id").length>0){if(u[d].getElementsByTagName("id")[0].childNodes.length>0){p[d].id=parseInt(u[d].getElementsByTagName("id")[0].childNodes[0].nodeValue)}}if(u[d].getElementsByTagName("url").length>0){if(u[d].getElementsByTagName("url")[0].childNodes.length>0){p[d].url=this._replaceXML(u[d].getElementsByTagName("url")[0].childNodes[0].nodeValue)}}if(u[d].getElementsByTagName("state").length>0){if(u[d].getElementsByTagName("state")[0].childNodes.length>0){p[d].state=parseInt(u[d].getElementsByTagName("state")[0].childNodes[0].nodeValue)}}if(u[d].getElementsByTagName("title").length>0){if(u[d].getElementsByTagName("title")[0].childNodes.length>0){p[d].title=this._replaceXML(u[d].getElementsByTagName("title")[0].childNodes[0].nodeValue)}}if(u[d].getElementsByTagName("imgUrl").length>0){if(u[d].getElementsByTagName("imgUrl")[0].childNodes.length>0){p[d].thumbnailurl=this._replaceXML(u[d].getElementsByTagName("imgUrl")[0].childNodes[0].nodeValue)}}if(u[d].getElementsByTagName("wvurl").length>0){if(u[d].getElementsByTagName("wvurl")[0].childNodes.length>0){p[d].wvurl=this._replaceXML(u[d].getElementsByTagName("wvurl")[0].childNodes[0].nodeValue)}}if(u[d].getElementsByTagName("format").length>0){if(u[d].getElementsByTagName("format")[0].childNodes.length>0){p[d].format=u[d].getElementsByTagName("format")[0].childNodes[0].nodeValue}}}}this.dialplayer.response({type:"PLAYLIST",data:p})}else if(o[0].getAttribute("type").match("slideshowResponse")){if(o[0].childNodes.length>0){this.dialplayer.response({type:"SLIDESHOW",data:o[0].childNodes[0].nodeValue})}}delete s}}this.tmp_msg=null}},_replaceXML:function(e){return e},_connectedPlayer:function(){var e=this.dialplayer.playlistpolicy;var t=this.dialplayer.device;var r=this.dialplayer.applicationid;if(!(typeof this.dialplayer.playlistpolicy==="number")){e=0}else{if(this.dialplayer.playlistpolicy!=0&&this.dialplayer.playlistpolicy!=1){e=0}}if(!(typeof this.dialplayer.device==="string")){t="device"}if(!(typeof this.dialplayer.applicationid==="string")){r="com.innopia.dial"}var a="<cmd type='set-device-name'><string>"+t+"</string><appId>"+r+"</appId><shared>"+e+"</shared></cmd>";this.playersocket.send(a);if(this.connectresult==false){this.dialplayer.success(this.dialplayer.server,innopia.dial.player.currentplayer);this.connectresult=true}},_sendData:function(e,t){if(this.playersocket!=null&&innopia.dial.player.currentplayer!=null&&innopia.dial.player.currentplayer.playerstatus!="DISCONNECTED"){dlog(t);this.playersocket.send(t)}else{if(this.connectresult=false||innopia.dial.player.currentplayer!=null&&innopia.dial.player.currentplayer.playerstatus=="DISCONNECTED"){this.dialplayer.response({type:"CMD_ERROR",data:{error:"connection_request",error_description:e}})}else{this.dialplayer.response({type:"CMD_ERROR",data:{error:"network_unreachable",error_description:e}})}}},disconnect:function(){if(this.playersocket!=null&&this.playersocket.readyState!="closed"){var e="<cmd type='disconnect'> </cmd>";this._sendData("disconnect",e);this.playersocket.close()}if(this.playerstatus!="DISCONNECTED"){this.playerstatus="DISCONNECTED";this.dialplayer.changestatus(this.playerstatus)}innopia.dial.player.currentplayer=null},addPlayList:function(e){var t="";var r=true;if(e==null||e.length==0){this.dialplayer.response({type:"CMD_ERROR",data:{error:"invalid_parameter",error_description:"addPlayList"}});return}if(typeof e==="object"){for(var a=0;e.length>a;a++){t+="<list>";if(typeof e[a].url==="string"){t+="<uri>"+e[a].url+"</uri>"}else{r=false;break}if(typeof e[a].title==="string"&&e[a].title!=""){t+="<title>"+e[a].title+"</title>"}if(typeof e[a].thumbnailUrl==="string"&&e[a].thumbnailUrl!=""){t+="<thumbnail>"+e[a].thumbnailUrl+"</thumbnail>"}if(typeof e[a].subtitle==="string"&&e[a].subtitle!=""){t+="<subtitle>"+e[a].subtitle+"</subtitle>"}if(typeof e[a].wvurl==="string"&&e[a].wvurl!=""){t+="<wvurl>"+e[a].wvurl+"</wvurl>"}t+="<format>"+e[a].format+"</format>";t+="</list>";if(a==49){break}}}else{r=false}if(r==true){t=t.replace(/\'/g,"''");var l="<cmd type='add-playlist'>"+t+"</cmd>";this._sendData("addPlayList",l)}else{this.dialplayer.response({type:"CMD_ERROR",data:{error:"invalid_parameter",error_description:"addPlayList"}})}},play_List:function(e,t,r){var a="";var l=true;if(e==null||e.length<=0||r<0||r&&t<-1){this.dialplayer.response({type:"CMD_ERROR",data:{error:"invalid_parameter",error_description:"play_List"}});return}if(typeof e==="object"&&typeof t==="number"&&typeof r==="number"){for(var i=0;e.length>i;i++){a+="<list>";if(typeof e[i].url==="string"){a+="<uri>"+e[i].url+"</uri>"}else{l=false;break}if(typeof e[i].title==="string"&&e[i].title!=""){a+="<title>"+e[i].title+"</title>"}if(typeof e[i].thumbnailUrl==="string"&&e[i].thumbnailUrl!=""){a+="<thumbnail>"+e[i].thumbnailUrl+"</thumbnail>"}if(typeof e[i].subtitle==="string"&&e[i].subtitle!=""){a+="<subtitle>"+e[i].subtitle+"</subtitle>"}if(typeof e[i].wvurl==="string"&&e[i].wvurl!=""){a+="<wvurl>"+e[i].wvurl+"</wvurl>"}a+="<format>"+e[i].format+"</format>";a+="</list>";if(i==49){break}}}else{l=false}if(l==true){a=a.replace(/\'/g,"''");var s="<cmd type='play'> "+a+"<position>"+t+"</position><index>"+r+"</index></cmd>";this._sendData("play_List",s)}else{this.dialplayer.response({type:"CMD_ERROR",data:{error:"invalid_parameter",error_description:"play_List"}})}},play_Id:function(e,t){if(typeof e==="number"&&typeof t==="number"){var r="<cmd type='play'><id>"+e+"</id><position>"+t+"</position></cmd>";this._sendData("play_Id",r)}else{this.dialplayer.response({type:"CMD_ERROR",data:{error:"invalid_parameter",error_description:"play_Id"}})}},show_Img:function(e,t){var r="";var a=true;if(typeof t!=="number"){this.dialplayer.response({type:"CMD_ERROR",data:{error:"invalid_parameter",error_description:"show_Img"}});return}for(var l=0;e.length>l;l++){if(typeof e[l]==="string"){r+="<list><uri>"+e[l]+"</uri></list>"}else{a=false;break}if(l==49){break}}if(a==true){r=r.replace(/\'/g,"''");var i="<cmd type='show'>"+r+"<slideshow>"+t+"</slideshow></cmd>";this._sendData("show_Img",i)}else{this.dialplayer.response({type:"CMD_ERROR",data:{error:"invalid_parameter",error_description:"show_Img"}})}},deleteAllPlayList:function(){var e="<cmd type='delete-all-playlist'></cmd>";this._sendData("deleteAllPlayList",e)},deletePlayList:function(e){var t="";var r=true;if(e.length>0){for(var a=0;e.length>a;a++){if(typeof e[a]==="number"){t+="<id>"+e[a]+"</id>"}else{r=false;break}}if(r==true){t=t.replace(/\'/g,"''");var l="<cmd type='delete-playlist'>"+t+"</cmd>";this._sendData("deletePlayList",l)}else{this.dialplayer.response({type:"CMD_ERROR",data:{error:"invalid_parameter",error_description:"deletePlayList"}})}}},pause:function(){var e="<cmd type='pause'> </cmd>";this._sendData("pause",e)},resume:function(){var e="<cmd type='resume'> </cmd>";this._sendData("resume",e)},stop:function(){var e="<cmd type='stop'> </cmd>";this._sendData("stop",e)},seek:function(e){if(typeof e==="number"&&e>=0){var t="<cmd type='seek'> <position>"+e+"</position> </cmd>";this._sendData("seek",t)}else{this.dialplayer.response({type:"CMD_ERROR",data:{error:"invalid_parameter",error_description:"seek"}})}},setLoop:function(e){if(typeof e==="string"&&(e=="true"||e=="false")){var t="<cmd type='loop'> <value>"+e+"</value> </cmd>";this._sendData("setLoop",t)}else{this.dialplayer.response({type:"CMD_ERROR",data:{error:"invalid_parameter",error_description:"setLoop"}})}},setMute:function(e){if(typeof e==="string"&&(e=="true"||e=="false")){var t="<cmd type='mute'> <value>"+e+"</value> </cmd>";this._sendData("setMute",t)}else{this.dialplayer.response({type:"CMD_ERROR",data:{error:"invalid_parameter",error_description:"setMute"}})}},setVolume:function(e){if(typeof e==="number"&&(e>=0&&e<=20)){var t="<cmd type='volume'> <value>"+e+"</value> </cmd>";this._sendData("setVolume",t)}else{this.dialplayer.response({type:"CMD_ERROR",data:{error:"invalid_parameter",error_description:"setVolume"}})}},requestMute:function(){var e="<cmd type='request-mute'></cmd>";this._sendData("requestMute",e)},requestVolume:function(){var e="<cmd type='request-volume'> </cmd>";this._sendData("requestVolume",e)},requestPosition:function(){var e="<cmd type='request-position'> </cmd>";this._sendData("requestPosition",e)},requestPlayerStatus:function(){var e="<cmd type='request-playerstatus'></cmd>";this._sendData("requestPlayerStatus",e)},requestLoop:function(){var e="<cmd type='request-loop'></cmd>";this._sendData("requestLoop",e)},requestPlayUrl:function(){var e="<cmd type='request-playlist'></cmd>";this._sendData("requestPlayUrl",e)},requestPlayList:function(){var e="<cmd type='request-playlist'></cmd>";this._sendData("requestPlayList",e)},requestSlideShowStatus:function(){var e="<cmd type='request-slideshow'></cmd>";this._sendData("requestSlideShowStatus",e)}};if(innopia.dial.player.currentplayer!=null){innopia.dial.player.currentplayer.disconnect();innopia.dial.player.currentplayer=null}innopia.dial.player.currentplayer=new t(e);innopia.dial.player.currentplayer.connectDialPlayer()};